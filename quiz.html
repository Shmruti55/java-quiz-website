<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz - Java Quiz Master</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            font-size: 1.5em;
            font-weight: bold;
        }

        .quiz-container {
            max-width: 900px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .quiz-header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quiz-info h2 {
            color: #333;
            margin-bottom: 10px;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .diff-easy { background: #e8f5e9; color: #388e3c; }
        .diff-medium { background: #fff3e0; color: #f57c00; }
        .diff-hard { background: #ffebee; color: #d32f2f; }

        .quiz-stats {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .timer {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1.5em;
            font-weight: bold;
        }

        .question-card {
            background: white;
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .question-number {
            color: #667eea;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.3em;
            color: #333;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            padding: 18px 25px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1em;
            background: #fafafa;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateX(5px);
        }

        .option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .option.correct {
            border-color: #388e3c;
            background: #e8f5e9;
            color: #388e3c;
        }

        .option.incorrect {
            border-color: #d32f2f;
            background: #ffebee;
            color: #d32f2f;
        }

        .option.disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .quiz-actions {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
        }

        .results-card {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }

        .results-card h2 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .score-display {
            font-size: 4em;
            font-weight: bold;
            color: #667eea;
            margin: 30px 0;
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .result-stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .result-stat-label {
            color: #666;
            margin-top: 5px;
        }

        .badges-earned {
            margin: 30px 0;
            padding: 20px;
            background: #fff9e6;
            border-radius: 10px;
        }

        .badges-earned h3 {
            color: #f57c00;
            margin-bottom: 15px;
        }

        .badge-list {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .badge-item {
            font-size: 3em;
        }

        @media (max-width: 768px) {
            .quiz-header {
                flex-direction: column;
                gap: 20px;
            }

            .quiz-stats {
                flex-wrap: wrap;
            }

            .results-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">🎓 Java Quiz Master</div>
        <button class="btn btn-secondary" onclick="exitQuiz()" style="padding: 8px 20px;">Exit Quiz</button>
    </nav>

    <div class="quiz-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>

        <div class="quiz-header">
            <div class="quiz-info">
                <h2 id="module-title">Module Title</h2>
                <span class="difficulty-badge" id="difficulty-badge">Medium</span>
            </div>
            <div class="quiz-stats">
                <div class="stat-item">
                    <div class="stat-value" id="score-display">0</div>
                    <div class="stat-label">Score</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="correct-display">0</div>
                    <div class="stat-label">Correct</div>
                </div>
                <div class="timer" id="timer">01:00</div>
            </div>
        </div>

        <div id="quiz-content">
            <div class="question-card">
                <div class="question-number" id="question-number">Question 1 of 10</div>
                <div class="question-text" id="question-text">Loading question...</div>
                <div class="options-container" id="options-container"></div>
            </div>

            <div class="quiz-actions">
                <button class="btn btn-secondary" onclick="previousQuestion()" id="prev-btn">Previous</button>
                <button class="btn btn-primary" onclick="nextQuestion()" id="next-btn" disabled>Next Question</button>
            </div>
        </div>

        <div id="results-content" style="display: none;">
            <!-- Results will be shown here -->
        </div>
    </div>

    <script>
        // Check authentication
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser) {
            window.location.href = 'index.html';
        }

        // Get selected module
        const selectedModule = parseInt(localStorage.getItem('selectedModule')) || 0;

        // Quiz questions database
        const quizQuestions = {
            0: [ // Prerequisites
                {
                    question: "What is the main principle of Object-Oriented Programming?",
                    options: ["Encapsulation", "Compilation", "Syntax", "Debugging"],
                    correct: 0,
                    difficulty: "easy"
                },
                {
                    question: "Which of the following is NOT a pillar of OOP?",
                    options: ["Inheritance", "Polymorphism", "Compilation", "Abstraction"],
                    correct: 2,
                    difficulty: "easy"
                },
                {
                    question: "What does API stand for?",
                    options: ["Application Programming Interface", "Advanced Programming Interface", "Application Process Interface", "Advanced Process Integration"],
                    correct: 0,
                    difficulty: "easy"
                },
                {
                    question: "In OOP, what is a class?",
                    options: ["A function", "A blueprint for objects", "A variable", "A loop"],
                    correct: 1,
                    difficulty: "medium"
                },
                {
                    question: "What is encapsulation in OOP?",
                    options: ["Hiding implementation details", "Creating multiple classes", "Using loops", "Declaring variables"],
                    correct: 0,
                    difficulty: "medium"
                },
                {
                    question: "Which data structure uses LIFO principle?",
                    options: ["Queue", "Stack", "Array", "Tree"],
                    correct: 1,
                    difficulty: "medium"
                },
                {
                    question: "What is the time complexity of accessing an element in an array?",
                    options: ["O(n)", "O(log n)", "O(1)", "O(n²)"],
                    correct: 2,
                    difficulty: "hard"
                },
                {
                    question: "Which sorting algorithm has the best average case time complexity?",
                    options: ["Bubble Sort", "Insertion Sort", "Merge Sort", "Selection Sort"],
                    correct: 2,
                    difficulty: "hard"
                },
                {
                    question: "What is polymorphism?",
                    options: ["Many forms", "Single form", "No form", "Two forms"],
                    correct: 0,
                    difficulty: "easy"
                },
                {
                    question: "What does DRY principle stand for?",
                    options: ["Don't Repeat Yourself", "Do Repeat Yourself", "Don't Return Yet", "Do Return Yearly"],
                    correct: 0,
                    difficulty: "medium"
                }
            ],
            1: [ // Introduction to OOP in Java
                {
                    question: "Which keyword is used to create a class in Java?",
                    options: ["class", "Class", "new", "object"],
                    correct: 0,
                    difficulty: "easy"
                },
                {
                    question: "What is the extension of Java source files?",
                    options: [".java", ".class", ".jar", ".jav"],
                    correct: 0,
                    difficulty: "easy"
                },
                {
                    question: "Which method is the entry point of a Java application?",
                    options: ["start()", "main()", "run()", "begin()"],
                    correct: 1,
                    difficulty: "easy"
                },
                {
                    question: "What is the correct syntax to create an object in Java?",
                    options: ["ClassName obj = new ClassName();", "ClassName obj = ClassName();", "new ClassName() = obj;", "create ClassName obj;"],
                    correct: 0,
                    difficulty: "medium"
                },
                {
                    question: "Which access modifier makes a member accessible only within its own class?",
                    options: ["public", "protected", "private", "default"],
                    correct: 2,
                    difficulty: "medium"
                },
                {
                    question: "What is constructor in Java?",
                    options: ["A method", "A special method to initialize objects", "A variable", "A class"],
                    correct: 1,
                    difficulty: "medium"
                },
                {
                    question: "Can a constructor be private in Java?",
                    options: ["Yes", "No", "Only in abstract classes", "Only in interfaces"],
                    correct: 0,
                    difficulty: "hard"
                },
                {
                    question: "What is method overloading?",
                    options: ["Same method name with different parameters", "Different method names", "Same method in different classes", "None of these"],
                    correct: 0,
                    difficulty: "medium"
                },
                {
                    question: "Which package is imported by default in Java?",
                    options: ["java.util", "java.io", "java.lang", "java.net"],
                    correct: 2,
                    difficulty: "hard"
                },
                {
                    question: "What is the use of 'this' keyword in Java?",
                    options: ["Refers to current object", "Creates new object", "Deletes object", "None"],
                    correct: 0,
                    difficulty: "medium"
                }
            ],
            2: [ // Inheritance & Exception Handling
                {
                    question: "Which keyword is used for inheritance in Java?",
                    options: ["inherits", "extends", "implements", "super"],
                    correct: 1,
                    difficulty: "easy"
                },
                {
                    question: "What is the maximum number of classes a Java class can extend?",
                    options: ["1", "2", "Multiple", "Unlimited"],
                    correct: 0,
                    difficulty: "easy"
                },
                {
                    question: "Which keyword is used to call parent class constructor?",
                    options: ["this", "super", "parent", "base"],
                    correct: 1,
                    difficulty: "easy"
                },
                {
                    question: "What is method overriding?",
                    options: ["Same method in child class", "Different method", "Constructor", "None"],
                    correct: 0,
                    difficulty: "medium"
                },
                {
                    question: "Which exception is thrown for array index out of bounds?",
                    options: ["ArrayException", "IndexException", "ArrayIndexOutOfBoundsException", "BoundsException"],
                    correct: 2,
                    difficulty: "medium"
                },
                {
                    question: "What is the parent class of all exception classes?",
                    options: ["Exception", "Throwable", "Error", "RuntimeException"],
                    correct: 1,
                    difficulty: "hard"
                },
                {
                    question: "Which block is always executed in exception handling?",
                    options: ["try", "catch", "finally", "throw"],
                    correct: 2,
                    difficulty: "medium"
                },
                {
                    question: "Can we have multiple catch blocks for a single try block?",
                    options: ["Yes", "No", "Only two", "Only three"],
                    correct: 0,
                    difficulty: "easy"
                },
                {
                    question: "What is the difference between throw and throws?",
                    options: ["throw is used to throw exception, throws declares exception", "No difference", "throws throws exception", "throw declares exception"],
                    correct: 0,
                    difficulty: "hard"
                },
                {
                    question: "Can we override static methods in Java?",
                    options: ["Yes", "No", "Only in child class", "Depends"],
                    correct: 1,
                    difficulty: "medium"
                }
            ]
        };

        // Add more modules (3-6) with placeholder questions
        for (let i = 3; i <= 6; i++) {
            quizQuestions[i] = quizQuestions[1].map(q => ({...q})); // Copy questions for now
        }

        // Quiz state
        let currentQuestionIndex = 0;
        let score = 0;
        let correctAnswers = 0;
        let selectedAnswer = null;
        let answered = false;
        let difficulty = "medium";
        let consecutiveCorrect = 0;
        let timeLeft = 60;
        let timerInterval;

        const questions = quizQuestions[selectedModule] || quizQuestions[0];
        const totalQuestions = questions.length;

        // Module names
        const moduleNames = {
            0: "Prerequisites",
            1: "Introduction to OOP in Java",
            2: "Inheritance & Exception Handling",
            3: "Client and Server Side Programming",
            4: "Fundamentals of Java Script",
            5: "Web Programming using React",
            6: "Application of Spring Framework"
        };

        // Initialize quiz
        document.getElementById('module-title').textContent = moduleNames[selectedModule];
        updateDifficultyBadge();
        loadQuestion();
        startTimer();

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    autoSubmit();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function autoSubmit() {
            if (!answered) {
                nextQuestion();
            }
        }

        function updateDifficultyBadge() {
            const badge = document.getElementById('difficulty-badge');
            badge.textContent = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
            badge.className = 'difficulty-badge diff-' + difficulty;
        }

        function loadQuestion() {
            answered = false;
            selectedAnswer = null;
            
            // Filter questions by difficulty
            const filteredQuestions = questions.filter(q => q.difficulty === difficulty);
            const question = filteredQuestions[currentQuestionIndex % filteredQuestions.length] || questions[currentQuestionIndex];
            
            document.getElementById('question-number').textContent = 
                `Question ${currentQuestionIndex + 1} of ${totalQuestions}`;
            document.getElementById('question-text').textContent = question.question;
            
            // Load options
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });
            
            // Update progress
            const progress = ((currentQuestionIndex) / totalQuestions) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            
            // Update buttons
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('next-btn').disabled = true;
        }

        function selectOption(index) {
            if (answered) return;
            
            selectedAnswer = index;
            
            // Update UI
            const options = document.querySelectorAll('.option');
            options.forEach((opt, i) => {
                opt.classList.remove('selected');
                if (i === index) {
                    opt.classList.add('selected');
                }
            });
            
            document.getElementById('next-btn').disabled = false;
        }

        function nextQuestion() {
            if (selectedAnswer === null && !answered) {
                alert('Please select an answer!');
                return;
            }
            
            if (!answered) {
                checkAnswer();
            }
            
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= totalQuestions) {
                showResults();
            } else {
                loadQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function checkAnswer() {
            answered = true;
            const filteredQuestions = questions.filter(q => q.difficulty === difficulty);
            const question = filteredQuestions[currentQuestionIndex % filteredQuestions.length] || questions[currentQuestionIndex];
            const options = document.querySelectorAll('.option');
            
            options.forEach(opt => opt.classList.add('disabled'));
            
            if (selectedAnswer === question.correct) {
                score += difficulty === "easy" ? 10 : difficulty === "medium" ? 20 : 30;
                correctAnswers++;
                consecutiveCorrect++;
                options[selectedAnswer].classList.add('correct');
                
                // Adaptive difficulty - increase after 2 correct
                if (consecutiveCorrect >= 2 && difficulty !== "hard") {
                    difficulty = difficulty === "easy" ? "medium" : "hard";
                    consecutiveCorrect = 0;
                    updateDifficultyBadge();
                }
            } else {
                consecutiveCorrect = 0;
                options[selectedAnswer].classList.add('incorrect');
                options[question.correct].classList.add('correct');
                
                // Adaptive difficulty - decrease after wrong
                if (difficulty !== "easy") {
                    difficulty = difficulty === "hard" ? "medium" : "easy";
                    updateDifficultyBadge();
                }
            }
            
            document.getElementById('score-display').textContent = score;
            document.getElementById('correct-display').textContent = correctAnswers;
        }

        function showResults() {
            clearInterval(timerInterval);
            
            // Update user stats
            currentUser.stats.totalQuizzes++;
            currentUser.stats.totalScore += score;
            
            // Award badges
            const newBadges = [];
            if (score >= 200) newBadges.push("🏆");
            if (correctAnswers === totalQuestions) newBadges.push("💯");
            if (score >= 250) newBadges.push("⭐");
            
            currentUser.stats.badges = [...new Set([...currentUser.stats.badges, ...newBadges])];
            
            // Update streak
            const today = new Date().toDateString();
            const lastDate = currentUser.stats.lastQuizDate;
            
            if (lastDate === today) {
                // Already played today
            } else if (lastDate === new Date(Date.now() - 86400000).toDateString()) {
                // Played yesterday - continue streak
                currentUser.stats.currentStreak++;
            } else {
                // Streak broken
                currentUser.stats.currentStreak = 1;
            }
            
            currentUser.stats.lastQuizDate = today;
            currentUser.stats.longestStreak = Math.max(
                currentUser.stats.longestStreak,
                currentUser.stats.currentStreak
            );
            
            // Update level
            const xpGained = score;
            currentUser.stats.xp += xpGained;
            currentUser.stats.level = Math.floor(currentUser.stats.xp / 100) + 1;
            // Update module progress
if (!currentUser.moduleProgress) {
    currentUser.moduleProgress = {};
}

// Calculate progress based on quizzes taken
const moduleQuizCount = currentUser.quizHistory.filter(q => q.moduleId === selectedModule).length;
const progressPerQuiz = 20; // Each quiz = 20% progress
const newProgress = Math.min(moduleQuizCount * progressPerQuiz, 100);
currentUser.moduleProgress[selectedModule] = newProgress;

            // Save quiz to history
if (!currentUser.quizHistory) {
    currentUser.quizHistory = [];
}

currentUser.quizHistory.push({
    moduleId: selectedModule,
    score: score,
    correctAnswers: correctAnswers,
    totalQuestions: totalQuestions,
    date: new Date().toISOString(),
    xpGained: score,
    badgesEarned: newBadges,
    difficulty: difficulty
});
            
            // Save to localStorage
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Update users array
            const users = JSON.parse(localStorage.getItem('users'));
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // Show results
            document.getElementById('quiz-content').style.display = 'none';
            document.getElementById('results-content').style.display = 'block';
            document.getElementById('results-content').innerHTML = `
                <div class="results-card">
                    <h2>Quiz Complete! 🎉</h2>
                    <div class="score-display">${score}</div>
                    <p style="font-size: 1.2em; color: #666;">Total Score</p>
                    
                    <div class="results-stats">
                        <div class="result-stat">
                            <div class="result-stat-value">${correctAnswers}/${totalQuestions}</div>
                            <div class="result-stat-label">Correct Answers</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${Math.round((correctAnswers/totalQuestions)*100)}%</div>
                            <div class="result-stat-label">Accuracy</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">+${xpGained}</div>
                            <div class="result-stat-label">XP Gained</div>
                        </div>
                    </div>
                    
                    ${newBadges.length > 0 ? `
                    <div class="badges-earned">
                        <h3>New Badges Earned!</h3>
                        <div class="badge-list">
                            ${newBadges.map(b => `<span class="badge-item">${b}</span>`).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="window.location.href='dashboard.html'">Back to Dashboard</button>
                        <button class="btn btn-secondary" onclick="window.location.reload()">Retry Quiz</button>
                    </div>
                </div>
            `;
        }

        function exitQuiz() {
            if (confirm('Are you sure you want to exit? Your progress will be lost.')) {
                window.location.href = 'dashboard.html';
            }
        }
    </script>
    <script src="darkmode.js"></script>
</body>

</html>


