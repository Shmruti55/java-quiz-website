<script>
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser) {
            window.location.href = 'index.html';
        }

        const selectedModule = parseInt(localStorage.getItem('selectedModule')) || 0;

        const quizQuestions = {
            0: [ // Prerequisites - 20 questions
                {question: "What is the main principle of Object-Oriented Programming?", options: ["Encapsulation", "Compilation", "Syntax", "Debugging"], correct: 0, difficulty: "easy"},
                {question: "Which of the following is NOT a pillar of OOP?", options: ["Inheritance", "Polymorphism", "Compilation", "Abstraction"], correct: 2, difficulty: "easy"},
                {question: "What does API stand for?", options: ["Application Programming Interface", "Advanced Programming Interface", "Application Process Interface", "Advanced Process Integration"], correct: 0, difficulty: "easy"},
                {question: "In OOP, what is a class?", options: ["A function", "A blueprint for objects", "A variable", "A loop"], correct: 1, difficulty: "medium"},
                {question: "What is encapsulation in OOP?", options: ["Hiding implementation details", "Creating multiple classes", "Using loops", "Declaring variables"], correct: 0, difficulty: "medium"},
                {question: "Which data structure uses LIFO principle?", options: ["Queue", "Stack", "Array", "Tree"], correct: 1, difficulty: "medium"},
                {question: "What is the time complexity of accessing an element in an array?", options: ["O(n)", "O(log n)", "O(1)", "O(n¬≤)"], correct: 2, difficulty: "hard"},
                {question: "Which sorting algorithm has the best average case time complexity?", options: ["Bubble Sort", "Insertion Sort", "Merge Sort", "Selection Sort"], correct: 2, difficulty: "hard"},
                {question: "What is polymorphism?", options: ["Many forms", "Single form", "No form", "Two forms"], correct: 0, difficulty: "easy"},
                {question: "What does DRY principle stand for?", options: ["Don't Repeat Yourself", "Do Repeat Yourself", "Don't Return Yet", "Do Return Yearly"], correct: 0, difficulty: "medium"},
                {question: "What is abstraction in OOP?", options: ["Hiding complex details", "Showing all details", "Creating objects", "Deleting objects"], correct: 0, difficulty: "medium"},
                {question: "Which programming paradigm focuses on objects?", options: ["Procedural", "Object-Oriented", "Functional", "Logical"], correct: 1, difficulty: "easy"},
                {question: "What is inheritance in OOP?", options: ["Creating new classes from existing ones", "Deleting classes", "Copying methods", "None of these"], correct: 0, difficulty: "medium"},
                {question: "What is a constructor?", options: ["Special method to initialize objects", "Destructor", "Variable", "Loop"], correct: 0, difficulty: "medium"},
                {question: "Which data structure uses FIFO principle?", options: ["Stack", "Queue", "Tree", "Graph"], correct: 1, difficulty: "easy"},
                {question: "What is method overloading?", options: ["Same name, different parameters", "Different names", "No parameters", "None"], correct: 0, difficulty: "hard"},
                {question: "What is the purpose of getter methods?", options: ["Access private variables", "Set values", "Delete objects", "Create objects"], correct: 0, difficulty: "medium"},
                {question: "What is composition in OOP?", options: ["Has-a relationship", "Is-a relationship", "Was-a relationship", "None"], correct: 0, difficulty: "hard"},
                {question: "What is an interface?", options: ["Contract for classes", "Concrete class", "Variable", "Method"], correct: 0, difficulty: "hard"},
                {question: "What is the difference between class and object?", options: ["Class is blueprint, object is instance", "No difference", "Object is blueprint", "Class is instance"], correct: 0, difficulty: "medium"}
            ],
            1: [ // Introduction to OOP in Java - 20 questions
                {question: "Which keyword is used to create a class in Java?", options: ["class", "Class", "new", "object"], correct: 0, difficulty: "easy"},
                {question: "What is the extension of Java source files?", options: [".java", ".class", ".jar", ".jav"], correct: 0, difficulty: "easy"},
                {question: "Which method is the entry point of a Java application?", options: ["start()", "main()", "run()", "begin()"], correct: 1, difficulty: "easy"},
                {question: "What is the correct syntax to create an object in Java?", options: ["ClassName obj = new ClassName();", "ClassName obj = ClassName();", "new ClassName() = obj;", "create ClassName obj;"], correct: 0, difficulty: "medium"},
                {question: "Which access modifier makes a member accessible only within its own class?", options: ["public", "protected", "private", "default"], correct: 2, difficulty: "medium"},
                {question: "What is constructor in Java?", options: ["A method", "A special method to initialize objects", "A variable", "A class"], correct: 1, difficulty: "medium"},
                {question: "Can a constructor be private in Java?", options: ["Yes", "No", "Only in abstract classes", "Only in interfaces"], correct: 0, difficulty: "hard"},
                {question: "What is method overloading?", options: ["Same method name with different parameters", "Different method names", "Same method in different classes", "None of these"], correct: 0, difficulty: "medium"},
                {question: "Which package is imported by default in Java?", options: ["java.util", "java.io", "java.lang", "java.net"], correct: 2, difficulty: "hard"},
                {question: "What is the use of 'this' keyword in Java?", options: ["Refers to current object", "Creates new object", "Deletes object", "None"], correct: 0, difficulty: "medium"},
                {question: "What is the size of int in Java?", options: ["16 bits", "32 bits", "64 bits", "8 bits"], correct: 1, difficulty: "easy"},
                {question: "Which keyword is used to prevent inheritance?", options: ["static", "final", "abstract", "private"], correct: 1, difficulty: "hard"},
                {question: "What is the default value of boolean in Java?", options: ["true", "false", "null", "0"], correct: 1, difficulty: "easy"},
                {question: "Can we overload main method in Java?", options: ["Yes", "No", "Only once", "Depends"], correct: 0, difficulty: "medium"},
                {question: "What is String in Java?", options: ["Primitive type", "Object", "Keyword", "Operator"], correct: 1, difficulty: "medium"},
                {question: "Which loop executes at least once?", options: ["while", "for", "do-while", "None"], correct: 2, difficulty: "easy"},
                {question: "What is garbage collection in Java?", options: ["Automatic memory management", "Manual deletion", "Compiler feature", "None"], correct: 0, difficulty: "hard"},
                {question: "Can we declare class as private in Java?", options: ["Yes", "No", "Only inner class", "Depends"], correct: 2, difficulty: "hard"},
                {question: "What is wrapper class in Java?", options: ["Object representation of primitives", "Primitive type", "Interface", "Abstract class"], correct: 0, difficulty: "medium"},
                {question: "Which operator is used for string concatenation?", options: ["+", "-", "*", "&"], correct: 0, difficulty: "easy"}
            ],
            2: [ // Inheritance & Exception Handling - 20 questions
                {question: "Which keyword is used for inheritance in Java?", options: ["inherits", "extends", "implements", "super"], correct: 1, difficulty: "easy"},
                {question: "What is the maximum number of classes a Java class can extend?", options: ["1", "2", "Multiple", "Unlimited"], correct: 0, difficulty: "easy"},
                {question: "Which keyword is used to call parent class constructor?", options: ["this", "super", "parent", "base"], correct: 1, difficulty: "easy"},
                {question: "What is method overriding?", options: ["Same method in child class", "Different method", "Constructor", "None"], correct: 0, difficulty: "medium"},
                {question: "Which exception is thrown for array index out of bounds?", options: ["ArrayException", "IndexException", "ArrayIndexOutOfBoundsException", "BoundsException"], correct: 2, difficulty: "medium"},
                {question: "What is the parent class of all exception classes?", options: ["Exception", "Throwable", "Error", "RuntimeException"], correct: 1, difficulty: "hard"},
                {question: "Which block is always executed in exception handling?", options: ["try", "catch", "finally", "throw"], correct: 2, difficulty: "medium"},
                {question: "Can we have multiple catch blocks for a single try block?", options: ["Yes", "No", "Only two", "Only three"], correct: 0, difficulty: "easy"},
                {question: "What is the difference between throw and throws?", options: ["throw is used to throw exception, throws declares exception", "No difference", "throws throws exception", "throw declares exception"], correct: 0, difficulty: "hard"},
                {question: "Can we override static methods in Java?", options: ["Yes", "No", "Only in child class", "Depends"], correct: 1, difficulty: "medium"},
                {question: "What is multilevel inheritance?", options: ["Chain of inheritance", "Multiple parents", "Single parent", "No inheritance"], correct: 0, difficulty: "medium"},
                {question: "Can constructors be inherited?", options: ["Yes", "No", "Only public", "Depends"], correct: 1, difficulty: "hard"},
                {question: "What is instanceof operator used for?", options: ["Check object type", "Create object", "Delete object", "None"], correct: 0, difficulty: "medium"},
                {question: "Which exception is checked exception?", options: ["NullPointerException", "IOException", "ArithmeticException", "ArrayIndexOutOfBoundsException"], correct: 1, difficulty: "hard"},
                {question: "Can we override private methods?", options: ["Yes", "No", "Only in same package", "Depends"], correct: 1, difficulty: "easy"},
                {question: "What is the purpose of finally block?", options: ["Execute cleanup code", "Catch exceptions", "Throw exceptions", "None"], correct: 0, difficulty: "medium"},
                {question: "Can abstract class have constructor?", options: ["Yes", "No", "Only default", "Depends"], correct: 0, difficulty: "hard"},
                {question: "What is method hiding in Java?", options: ["Static method in child with same name", "Private method", "Abstract method", "None"], correct: 0, difficulty: "hard"},
                {question: "Which keyword is used to prevent method overriding?", options: ["static", "final", "private", "abstract"], correct: 1, difficulty: "medium"},
                {question: "Can we catch multiple exceptions in single catch?", options: ["Yes with pipe", "No", "Only in Java 7+", "Both A and C"], correct: 3, difficulty: "medium"}
            ],
            3: [ // Client and Server Side Programming (JDBC) - 20 questions
                {question: "What does JDBC stand for?", options: ["Java Database Connectivity", "Java Data Connection", "Java Direct Communication", "Java Database Connection"], correct: 0, difficulty: "easy"},
                {question: "Which package contains JDBC classes?", options: ["java.jdbc", "java.sql", "java.database", "java.db"], correct: 1, difficulty: "easy"},
                {question: "Which JDBC driver type is pure Java driver?", options: ["Type 1", "Type 2", "Type 3", "Type 4"], correct: 3, difficulty: "medium"},
                {question: "Which method is used to execute SQL SELECT query?", options: ["execute()", "executeQuery()", "executeUpdate()", "executeSql()"], correct: 1, difficulty: "medium"},
                {question: "What is PreparedStatement used for?", options: ["Precompiled SQL", "Dynamic queries", "Batch processing", "All of these"], correct: 3, difficulty: "medium"},
                {question: "Which method commits a transaction in JDBC?", options: ["commit()", "save()", "execute()", "finish()"], correct: 0, difficulty: "easy"},
                {question: "What is ResultSet in JDBC?", options: ["Table data", "Query result", "Database cursor", "All of these"], correct: 3, difficulty: "hard"},
                {question: "Which JDBC driver connects Java to database via ODBC?", options: ["Type 1", "Type 2", "Type 3", "Type 4"], correct: 0, difficulty: "hard"},
                {question: "What does executeUpdate() method return?", options: ["ResultSet", "Boolean", "Number of rows affected", "Connection"], correct: 2, difficulty: "medium"},
                {question: "Which method is used to close database connection?", options: ["close()", "end()", "disconnect()", "terminate()"], correct: 0, difficulty: "easy"},
                {question: "What is Statement interface used for?", options: ["Execute SQL queries", "Create connection", "Close connection", "None"], correct: 0, difficulty: "medium"},
                {question: "Which method moves cursor to next row in ResultSet?", options: ["next()", "move()", "forward()", "advance()"], correct: 0, difficulty: "easy"},
                {question: "What is CallableStatement used for?", options: ["Stored procedures", "SELECT queries", "INSERT queries", "CREATE queries"], correct: 0, difficulty: "hard"},
                {question: "Which method sets auto-commit to false?", options: ["setAutoCommit(false)", "autoCommit(false)", "commit(false)", "noCommit()"], correct: 0, difficulty: "medium"},
                {question: "What is batch processing in JDBC?", options: ["Execute multiple queries together", "Single query", "Connection pooling", "None"], correct: 0, difficulty: "hard"},
                {question: "Which method retrieves data from ResultSet?", options: ["get()", "retrieve()", "getString()", "fetch()"], correct: 2, difficulty: "medium"},
                {question: "What is DriverManager used for?", options: ["Manage JDBC drivers", "Execute queries", "Create tables", "None"], correct: 0, difficulty: "easy"},
                {question: "Which method rollbacks a transaction?", options: ["rollback()", "undo()", "revert()", "cancel()"], correct: 0, difficulty: "medium"},
                {question: "What is connection pooling?", options: ["Reusing database connections", "Creating connections", "Closing connections", "None"], correct: 0, difficulty: "hard"},
                {question: "Which exception is thrown for SQL errors?", options: ["SQLException", "DatabaseException", "SQLError", "JDBCException"], correct: 0, difficulty: "easy"}
            ],
            4: [ // Fundamentals of JavaScript/Servlets/JSP - 20 questions
                {question: "What is a Servlet in Java?", options: ["Server-side component", "Client-side script", "Database driver", "HTML template"], correct: 0, difficulty: "easy"},
                {question: "Which method handles GET requests in Servlet?", options: ["doGet()", "handleGet()", "processGet()", "serviceGet()"], correct: 0, difficulty: "easy"},
                {question: "What does JSP stand for?", options: ["Java Server Pages", "JavaScript Pages", "Java Standard Pages", "Java Servlet Pages"], correct: 0, difficulty: "easy"},
                {question: "Which object represents HTTP request in Servlet?", options: ["HttpServletRequest", "ServletRequest", "RequestObject", "HTTPRequest"], correct: 0, difficulty: "medium"},
                {question: "What is the DOM in JavaScript?", options: ["Data Object Model", "Document Object Model", "Dynamic Object Model", "Display Object Model"], correct: 1, difficulty: "easy"},
                {question: "Which method is used to get form data in Servlet?", options: ["getParameter()", "getData()", "getForm()", "retrieveData()"], correct: 0, difficulty: "medium"},
                {question: "What is session tracking in Servlets?", options: ["Tracking user sessions", "Database tracking", "Error tracking", "Performance tracking"], correct: 0, difficulty: "medium"},
                {question: "Which HTTP method is used to submit form data?", options: ["GET", "POST", "PUT", "Both GET and POST"], correct: 3, difficulty: "hard"},
                {question: "What is servlet lifecycle?", options: ["init(), service(), destroy()", "start(), run(), stop()", "create(), execute(), end()", "begin(), process(), finish()"], correct: 0, difficulty: "hard"},
                {question: "Which JavaScript method adds HTML content to element?", options: ["innerHTML", "addHTML", "setContent", "insertHTML"], correct: 0, difficulty: "medium"},
                {question: "What is HttpSession used for?", options: ["Store user data across requests", "Handle HTTP", "Execute queries", "None"], correct: 0, difficulty: "medium"},
                {question: "Which method handles POST requests?", options: ["doPost()", "handlePost()", "processPost()", "servicePost()"], correct: 0, difficulty: "easy"},
                {question: "What is RequestDispatcher used for?", options: ["Forward or include resources", "Handle requests", "Create sessions", "None"], correct: 0, difficulty: "hard"},
                {question: "Which method sends redirect response?", options: ["sendRedirect()", "redirect()", "forward()", "move()"], correct: 0, difficulty: "medium"},
                {question: "What is filter in Servlets?", options: ["Intercepts requests/responses", "Database filter", "HTML filter", "None"], correct: 0, difficulty: "hard"},
                {question: "Which JavaScript method selects element by ID?", options: ["getElementById()", "selectId()", "getElement()", "findById()"], correct: 0, difficulty: "easy"},
                {question: "What is ServletConfig used for?", options: ["Servlet initialization parameters", "HTTP configuration", "Database config", "None"], correct: 0, difficulty: "medium"},
                {question: "Which method gets servlet name?", options: ["getServletName()", "getName()", "getServlet()", "servletName()"], correct: 0, difficulty: "medium"},
                {question: "What is cookie in Servlets?", options: ["Small data stored on client", "Server data", "Database entry", "None"], correct: 0, difficulty: "easy"},
                {question: "Which JavaScript event fires on page load?", options: ["onclick", "onload", "onstart", "onready"], correct: 1, difficulty: "medium"}
            ],
            5: [ // Web Programming using React - 20 questions
                {question: "What is React?", options: ["JavaScript library for UI", "Programming language", "Database", "Web server"], correct: 0, difficulty: "easy"},
                {question: "What are components in React?", options: ["Reusable UI pieces", "Database tables", "CSS files", "HTML tags"], correct: 0, difficulty: "easy"},
                {question: "What is JSX in React?", options: ["JavaScript XML", "Java Syntax Extension", "JSON Extended", "JavaScript Export"], correct: 0, difficulty: "easy"},
                {question: "What are props in React?", options: ["Properties passed to components", "CSS properties", "HTML attributes", "State variables"], correct: 0, difficulty: "medium"},
                {question: "What is state in React?", options: ["Component's data", "CSS styling", "HTML structure", "Props values"], correct: 0, difficulty: "medium"},
                {question: "Which hook is used to manage state?", options: ["useState", "useEffect", "useContext", "useReducer"], correct: 0, difficulty: "medium"},
                {question: "What is conditional rendering in React?", options: ["Render based on condition", "Render all components", "CSS rendering", "HTML rendering"], correct: 0, difficulty: "easy"},
                {question: "What is React Router used for?", options: ["Navigation between pages", "State management", "API calls", "Styling"], correct: 0, difficulty: "hard"},
                {question: "What is Virtual DOM?", options: ["Lightweight copy of DOM", "Real DOM", "Database", "CSS model"], correct: 0, difficulty: "hard"},
                {question: "Which method is called when component mounts?", options: ["componentDidMount", "componentStart", "componentInit", "componentRender"], correct: 0, difficulty: "medium"},
                {question: "What is useEffect hook used for?", options: ["Side effects", "State management", "Props passing", "Routing"], correct: 0, difficulty: "medium"},
                {question: "What are React fragments?", options: ["Group elements without div", "Database fragments", "CSS fragments", "None"], correct: 0, difficulty: "hard"},
                {question: "What is prop drilling?", options: ["Passing props through multiple levels", "Creating props", "Deleting props", "None"], correct: 0, difficulty: "hard"},
                {question: "Which method updates state?", options: ["setState", "updateState", "changeState", "modifyState"], correct: 0, difficulty: "easy"},
                {question: "What is React context?", options: ["Global state management", "Local state", "Props", "Events"], correct: 0, difficulty: "medium"},
                {question: "What are controlled components?", options: ["Form inputs controlled by state", "Uncontrolled inputs", "Props components", "None"], correct: 0, difficulty: "hard"},
                {question: "What is useRef hook used for?", options: ["Reference DOM elements", "State management", "Side effects", "Routing"], correct: 0, difficulty: "medium"},
                {question: "What is React lifecycle?", options: ["Component creation to unmounting", "Rendering only", "Props passing", "None"], correct: 0, difficulty: "hard"},
                {question: "What is key prop in React lists?", options: ["Unique identifier for elements", "CSS property", "Event handler", "None"], correct: 0, difficulty: "medium"},
                {question: "What is React.memo()?", options: ["Performance optimization", "State management", "Routing", "Styling"], correct: 0, difficulty: "hard"}
            ],
            6: [ // Application of Spring Framework - 20 questions
                {question: "What is Spring Framework?", options: ["Java application framework", "Database", "Web server", "Programming language"], correct: 0, difficulty: "easy"},
                {question: "What is Dependency Injection?", options: ["Design pattern for loose coupling", "Database injection", "Code injection", "SQL injection"], correct: 0, difficulty: "easy"},
                {question: "What does IoC stand for?", options: ["Inversion of Control", "Input Output Control", "Internal Object Control", "Interface of Control"], correct: 0, difficulty: "easy"},
                {question: "What is AOP in Spring?", options: ["Aspect Oriented Programming", "Application Object Programming", "Advanced Object Processing", "Automated Object Protocol"], correct: 0, difficulty: "medium"},
                {question: "What is Spring MVC?", options: ["Model View Controller", "Most Valuable Component", "Model Variable Control", "Main View Component"], correct: 0, difficulty: "medium"},
                {question: "Which annotation marks a class as controller?", options: ["@Controller", "@Component", "@Service", "@Bean"], correct: 0, difficulty: "medium"},
                {question: "What is Spring Boot?", options: ["Simplifies Spring development", "Database tool", "Testing framework", "Web server"], correct: 0, difficulty: "easy"},
                {question: "What are RESTful services?", options: ["Architectural style for APIs", "Database services", "File services", "Email services"], correct: 0, difficulty: "hard"},
                {question: "Which annotation for dependency injection?", options: ["@Autowired", "@Inject", "@Resource", "All of these"], correct: 3, difficulty: "hard"},
                {question: "What is @RequestMapping for?", options: ["Map HTTP requests", "Map database tables", "Map variables", "Map objects"], correct: 0, difficulty: "medium"},
                {question: "What is @Component annotation?", options: ["Marks class as Spring bean", "Database component", "View component", "None"], correct: 0, difficulty: "medium"},
                {question: "What is @Service annotation used for?", options: ["Business logic layer", "Controller layer", "Database layer", "View layer"], correct: 0, difficulty: "medium"},
                {question: "What is @Repository for?", options: ["Data access layer", "Service layer", "Controller layer", "None"], correct: 0, difficulty: "medium"},
                {question: "What is Spring Bean?", options: ["Object managed by Spring", "Database bean", "Java bean", "Session bean"], correct: 0, difficulty: "easy"},
                {question: "What is @Configuration annotation?", options: ["Define configuration classes", "Database config", "View config", "None"], correct: 0, difficulty: "hard"},
                {question: "What is ApplicationContext?", options: ["Spring IoC container", "Database context", "Web context", "None"], correct: 0, difficulty: "hard"},
                {question: "What is @ResponseBody used for?", options: ["Return data as JSON/XML", "HTML response", "Redirect response", "None"], correct: 0, difficulty: "medium"},
                {question: "What is Spring Data JPA?", options: ["Database access framework", "View framework", "Security framework", "None"], correct: 0, difficulty: "hard"},
                {question: "What is @PathVariable for?", options: ["Extract values from URL", "Request parameters", "Form data", "None"], correct: 0, difficulty: "medium"},
                {question: "What is Spring Security?", options: ["Authentication and authorization", "Database security", "Network security", "None"], correct: 0, difficulty: "medium"}
            ]
        };

        // Rest of the JavaScript code remains the same...
        let currentQuestionIndex = 0;
        let score = 0;
        let correctAnswers = 0;
        let selectedAnswer = null;
        let answered = false;
        let difficulty = "medium";
        let consecutiveCorrect = 0;
        let timeLeft = 120; // Changed to 2 minutes for 20 questions
        let timerInterval;

        const questions = quizQuestions[selectedModule] || quizQuestions[0];
        const totalQuestions = questions.length;

        const moduleNames = {
            0: "Prerequisites",
            1: "Introduction to OOP in Java",
            2: "Inheritance & Exception Handling",
            3: "Client and Server Side Programming",
            4: "Fundamentals of Java Script",
            5: "Web Programming using React",
            6: "Application of Spring Framework"
        };

        document.getElementById('module-title').textContent = moduleNames[selectedModule];
        updateDifficultyBadge();
        loadQuestion();
        startTimer();

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    autoSubmit();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function autoSubmit() {
            if (!answered) {
                nextQuestion();
            }
        }

        function updateDifficultyBadge() {
            const badge = document.getElementById('difficulty-badge');
            badge.textContent = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
            badge.className = 'difficulty-badge diff-' + difficulty;
        }

        function loadQuestion() {
            answered = false;
            selectedAnswer = null;
            
            const filteredQuestions = questions.filter(q => q.difficulty === difficulty);
            const question = filteredQuestions[currentQuestionIndex % filteredQuestions.length] || questions[currentQuestionIndex];
            
            document.getElementById('question-number').textContent = 
                `Question ${currentQuestionIndex + 1} of ${totalQuestions}`;
            document.getElementById('question-text').textContent = question.question;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });
            
            const progress = ((currentQuestionIndex) / totalQuestions) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('next-btn').disabled = true;
        }

        function selectOption(index) {
            if (answered) return;
            
            selectedAnswer = index;
            
            const options = document.querySelectorAll('.option');
            options.forEach((opt, i) => {
                opt.classList.remove('selected');
                if (i === index) {
                    opt.classList.add('selected');
                }
            });
            
            document.getElementById('next-btn').disabled = false;
        }

        function nextQuestion() {
            if (selectedAnswer === null && !answered) {
                alert('Please select an answer!');
                return;
            }
            
            if (!answered) {
                checkAnswer();
            }
            
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= totalQuestions) {
                showResults();
            } else {
                loadQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function checkAnswer() {
            answered = true;
            const filteredQuestions = questions.filter(q => q.difficulty === difficulty);
            const question = filteredQuestions[currentQuestionIndex % filteredQuestions.length] || questions[currentQuestionIndex];
            const options = document.querySelectorAll('.option');
            
            options.forEach(opt => opt.classList.add('disabled'));
            
            if (selectedAnswer === question.correct) {
                score += difficulty === "easy" ? 10 : difficulty === "medium" ? 20 : 30;
                correctAnswers++;
                consecutiveCorrect++;
                options[selectedAnswer].classList.add('correct');
                
                if (consecutiveCorrect >= 2 && difficulty !== "hard") {
                    difficulty = difficulty === "easy" ? "medium" : "hard";
                    consecutiveCorrect = 0;
                    updateDifficultyBadge();
                }
            } else {
                consecutiveCorrect = 0;
                options[selectedAnswer].classList.add('incorrect');
                options[question.correct].classList.add('correct');
                
                if (difficulty !== "easy") {
                    difficulty = difficulty === "hard" ? "medium" : "easy";
                    updateDifficultyBadge();
                }
            }
            
            document.getElementById('score-display').textContent = score;
            document.getElementById('correct-display').textContent = correctAnswers;
        }

        function showResults() {
            clearInterval(timerInterval);
            
            currentUser.stats.totalQuizzes++;
            currentUser.stats.totalScore += score;
            
            const newBadges = [];
            if (score >= 300) newBadges.push("üèÜ");
            if (correctAnswers === totalQuestions) newBadges.push("üíØ");
            if (score >= 400) newBadges.push("‚≠ê");
            
            current
